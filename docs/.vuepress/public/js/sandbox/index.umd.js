!function(g,I){"object"==typeof exports&&"undefined"!=typeof module?I(exports,require("@wu-component/web-core-plus")):"function"==typeof define&&define.amd?define(["exports","@wu-component/web-core-plus"],I):I((g="undefined"!=typeof globalThis?globalThis:g||self).WuCodeSandbox={},g.webCorePlus)}(this,(function(g,I){"use strict";var C=function(g,I){return C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,I){g.__proto__=I}||function(g,I){for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(g[C]=I[C])},C(g,I)};var A=function(){return A=Object.assign||function(g){for(var I,C=1,A=arguments.length;C<A;C++)for(var e in I=arguments[C])Object.prototype.hasOwnProperty.call(I,e)&&(g[e]=I[e]);return g},A.apply(this,arguments)};function e(g,I,C,A){var e,n=arguments.length,o=n<3?I:null===A?A=Object.getOwnPropertyDescriptor(I,C):A;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(g,I,C,A);else for(var c=g.length-1;c>=0;c--)(e=g[c])&&(o=(n<3?e(o):n>3?e(I,C,o):e(I,C))||o);return n>3&&o&&Object.defineProperty(I,C,o),o}function n(g,I){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(g,I)}function o(g,I,C,A){return new(C||(C=Promise))((function(e,n){function o(g){try{t(A.next(g))}catch(g){n(g)}}function c(g){try{t(A.throw(g))}catch(g){n(g)}}function t(g){var I;g.done?e(g.value):(I=g.value,I instanceof C?I:new C((function(g){g(I)}))).then(o,c)}t((A=A.apply(g,I||[])).next())}))}function c(g,I){var C,A,e,n,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return n={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function c(n){return function(c){return function(n){if(C)throw new TypeError("Generator is already executing.");for(;o;)try{if(C=1,A&&(e=2&n[0]?A.return:n[0]?A.throw||((e=A.return)&&e.call(A),0):A.next)&&!(e=e.call(A,n[1])).done)return e;switch(A=0,e&&(n=[2&n[0],e.value]),n[0]){case 0:case 1:e=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,A=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(e=o.trys,(e=e.length>0&&e[e.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!e||n[1]>e[0]&&n[1]<e[3])){o.label=n[1];break}if(6===n[0]&&o.label<e[1]){o.label=e[1],e=n;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(n);break}e[2]&&o.ops.pop(),o.trys.pop();continue}n=I.call(g,o)}catch(g){n=[6,g],A=0}finally{C=e=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,c])}}}var t=":host {\n  width: 100%;\n  height: 100%;\n}\n\n.containerViewer {\n  width: 100%;\n  height: 100%;\n}\n\n#codeIframe {\n  width: 100%;\n  height: 100%;\n}";!function(g,I){void 0===I&&(I={});var C=I.insertAt;if(g&&"undefined"!=typeof document){var A=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css","top"===C&&A.firstChild?A.insertBefore(e,A.firstChild):A.appendChild(e),e.styleSheet?e.styleSheet.cssText=g:e.appendChild(document.createTextNode(g))}}(t);var l=1,i=function(){function g(g,I){var C=this;this.iframe=g,this.handlers=I,this.pending_cmds=new Map,this.handle_event=function(g){return C.handle_repl_message(g)},window.addEventListener("message",this.handle_event,!1)}return g.prototype.destroy=function(){window.removeEventListener("message",this.handle_event)},g.prototype.iframe_command=function(g,I){var C=this;return new Promise((function(A,e){var n=l++;C.pending_cmds.set(n,{resolve:A,reject:e}),C.iframe.contentWindow.postMessage({action:g,cmd_id:n,args:I},"*")}))},g.prototype.handle_command_message=function(g){var I=g.action,C=g.cmd_id,A=this.pending_cmds.get(C);if(A){if(this.pending_cmds.delete(C),"cmd_error"===I){var e=g.message,n=g.stack,o=new Error(e);o.stack=n,A.reject(o)}"cmd_ok"===I&&A.resolve(g.args)}else"cmd_error"!==I&&"cmd_ok"!==I&&console.error("command not found",C,g,function(g,I,C){if(C||2===arguments.length)for(var A,e=0,n=I.length;e<n;e++)!A&&e in I||(A||(A=Array.prototype.slice.call(I,0,e)),A[e]=I[e]);return g.concat(A||Array.prototype.slice.call(I))}([],function(g,I){var C="function"==typeof Symbol&&g[Symbol.iterator];if(!C)return g;var A,e,n=C.call(g),o=[];try{for(;(void 0===I||I-- >0)&&!(A=n.next()).done;)o.push(A.value)}catch(g){e={error:g}}finally{try{A&&!A.done&&(C=n.return)&&C.call(n)}finally{if(e)throw e.error}}return o}(this.pending_cmds.keys()),!1))},g.prototype.handle_repl_message=function(g){if(g.source===this.iframe.contentWindow){var I=g.data,C=I.action,A=I.args;switch(this.handlers.on_default_event(g),C){case"cmd_error":case"cmd_ok":return this.handle_command_message(g.data);case"fetch_progress":return this.handlers.on_fetch_progress(A.remaining);case"error":return this.handlers.on_error(g.data);case"unhandledrejection":return this.handlers.on_unhandled_rejection(g.data);case"console":return this.handlers.on_console(g.data);case"console_group":return this.handlers.on_console_group(g.data);case"console_group_collapsed":return this.handlers.on_console_group_collapsed(g.data);case"console_group_end":return this.handlers.on_console_group_end(g.data)}}},g.prototype.eval=function(g){return this.iframe_command("eval",{script:g})},g.prototype.handle_links=function(){return this.iframe_command("catch_clicks",{})},g.prototype.load_depend=function(g){return this.iframe_command("load_dependencies",g)},g}(),d="CODE_DEPENDENCIES",s="CODE_TYPES",b=function(){function g(g){void 0===g&&(g={dependencies:{},types:{}}),this.code=[],this.init(g)}return g.prototype.init=function(g){var I=g.dependencies,C=void 0===I?{}:I,e=g.types,n=void 0===e?{}:e,o=localStorage.getItem(d)?JSON.parse(localStorage.getItem(d)):{},c=localStorage.getItem(s)?JSON.parse(localStorage.getItem(s)):{};o=A(A({},o),C||{}),c=A(A({},c),{types:n||{}}),localStorage.setItem(d,JSON.stringify(o)),localStorage.setItem(s,JSON.stringify(c)),this.__dependencies=o,this.__types=c},g.prototype.createDependencies=function(g,I){this.__dependencies=A(A({},this.__dependencies),{name:I}),localStorage.setItem(d,JSON.stringify(this.__dependencies))},Object.defineProperty(g.prototype,"dependencies",{get:function(){return this.__dependencies},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"types",{get:function(){return this.__types},enumerable:!1,configurable:!0}),g.prototype.pushStackCode=function(g){this.code.push(g)},g}(),r=function(g){function A(){var I=g.call(this)||this;return I.container=null,I}return function(g,I){if("function"!=typeof I&&null!==I)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function A(){this.constructor=g}C(g,I),g.prototype=null===I?Object.create(I):(A.prototype=I.prototype,new A)}(A,g),A.prototype.formatFile=function(g){return new Promise((function(I){if(g.startsWith("data:")){for(var C=g.split(","),A=atob(C[1]),e=A.length,n=new Uint8Array(e);e--;)n[e]=A.charCodeAt(e);var o=new File([n],"srcdoc.html",{type:"text/html"}),c=new FileReader;c.onload=function(){I(c.result)},c.readAsText(o,"utf-8")}else I(g)}))},A.prototype.connected=function(g){return o(this,void 0,void 0,(function(){var I,C,A,e,n,o=this;return c(this,(function(c){switch(c.label){case 0:return I=this.props.initialSrcDoc,this.container=g.querySelector("#codeIframe"),C=document.createElement("div"),A={},I?(e=this,[4,this.formatFile(I)]):[3,2];case 1:e.initialSrcDoc=c.sent(),C.innerHTML=this.initialSrcDoc,n=C.querySelector("#dependenciesMap"),A=JSON.parse(n.innerHTML)?JSON.parse(n.innerHTML).imports:{},c.label=2;case 2:return this.previewStore=new b({dependencies:A}),this.proxy=new i(this.container,{on_fetch_progress:function(g){},on_error:function(g){console.log("on_error",g)},on_unhandled_rejection:function(g){console.log("on_unhandled_rejection",g)},on_console:function(g){console.log("log",g)},on_console_group:function(g){},on_console_group_end:function(g){},on_console_group_collapsed:function(g){},on_default_event:function(g){o.emitEvent(g)}}),this.container.addEventListener("load",(function(){o.proxy.handle_links().then((function(g){})),o.proxy.load_depend({dependencies:o.previewStore.dependencies}).then((function(){for(var g=0;g<o.previewStore.code.length;g++)o.proxy.eval(o.previewStore.code[g]);o.previewStore.code=[]}))})),this.container.setAttribute("srcdoc",this.initialSrcDoc),[2]}}))}))},A.prototype.runCode=function(g,I){this.props.isBeforeRefresh?(this.container.contentWindow.location.reload(),this.previewStore.pushStackCode(I)):this.proxy.eval(I)},A.prototype.loadDependencies=function(g){return this.proxy.load_depend(g)},A.prototype.emitEvent=function(g){return{data:g||{}}},A.prototype.render=function(g,C){return I.h("div",{class:"containerViewer"},I.h("iframe",{frameBorder:"0",id:"codeIframe",sandbox:["allow-forms","allow-modals","allow-pointer-lock","allow-popups","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"].join(" ")}))},e([I.Prop({type:String,default:"data:text/html;base64,PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPHN0eWxlPg0KICAgICAgICBib2R5LCBodG1sICB7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgIH0NCiAgICA8L3N0eWxlPg0KICAgIDx0aXRsZT5UaXRsZTwvdGl0bGU+DQogICAgPHNjcmlwdCBhc3luYyBzcmM9Imh0dHBzOi8vdW5wa2cuY29tL2VzLW1vZHVsZS1zaGltc0AxLjUuMTgvZGlzdC9lcy1tb2R1bGUtc2hpbXMud2FzbS5qcyI+PC9zY3JpcHQ+DQogICAgPCEtLSBmb3IgdHlwZXNjcmlwdCB0YXJnZXQ6IEFNRCAtLT4NCiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL3JlcXVpcmVqcy9yZXF1aXJlanMvcmVxdWlyZS5qcyI+PC9zY3JpcHQ+DQogICAgPCEtLTxzY3JpcHQgc3JjPSJodHRwczovL3VucGtnLmNvbS9Ad3UtY29tcG9uZW50L3dlYi1jb3JlLXBsdXNAMC4zLjMvZGlzdC9pbmRleC5lcy5qcyI+PC9zY3JpcHQ+LS0+DQogICAgPHNjcmlwdCB0eXBlPSJpbXBvcnRtYXAiIGlkPSJkZXBlbmRlbmNpZXNNYXAiPg0KICAgICAgICB7DQogICAgICAgICAgImltcG9ydHMiOiB7DQogICAgICAgICAgICAiQHd1LWNvbXBvbmVudC93ZWItY29yZS1wbHVzIjogImh0dHBzOi8vdW5wa2cuY29tL0B3dS1jb21wb25lbnQvd2ViLWNvcmUtcGx1c0AwLjMuMy9kaXN0L2luZGV4LmVzLmpzIg0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KICAgIDxzY3JpcHQ+DQogICAgICAgICgoKSA9PiB7DQogICAgICAgICAgICBsZXQgc2NyaXB0RWxzID0gW10NCg0KICAgICAgICAgICAgd2luZG93LnByb2Nlc3MgPSB7IGVudjoge30gfQ0KICAgICAgICAgICAgd2luZG93Ll9fbW9kdWxlc19fID0ge30NCg0KICAgICAgICAgICAgd2luZG93Ll9fZXhwb3J0X18gPSAobW9kLCBrZXksIGdldCkgPT4gew0KICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2QsIGtleSwgew0KICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5fX2R5bmFtaWNfaW1wb3J0X18gPSBrZXkgPT4gew0KICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUod2luZG93Ll9fbW9kdWxlc19fW2tleV0pDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICog5Yqg6L295L6d6LWWDQogICAgICAgICAgICAgKiBAcGFyYW0gb3B0aW9ucw0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBmdW5jdGlvbiBsb2FkX2RlcGVuZGVuY2llcyhvcHRpb25zKSB7DQogICAgICAgICAgICAgICAgY29uc3QgZG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2RlcGVuZGVuY2llc01hcCIpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBKU09OLnBhcnNlKGRvbS5pbm5lckhUTUwpPyBKU09OLnBhcnNlKGRvbS5pbm5lckhUTUwpLmltcG9ydHM6IHt9DQogICAgICAgICAgICAgICAgY29uc3QgbmV3RGVwZW5kZW5jaWVzID0gT2JqZWN0LmFzc2lnbih7fSwgY3VycmVudCwgb3B0aW9ucy5kZXBlbmRlbmNpZXMgfHwge30pOw0KICAgICAgICAgICAgICAgIGRvbS5pbm5lckhUTUwgPSBKU09OLnN0cmluZ2lmeSh7DQogICAgICAgICAgICAgICAgICAgICJpbXBvcnRzIjogbmV3RGVwZW5kZW5jaWVzDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICBjb25zdCBuZXdEb20gPSBkb20uY2xvbmVOb2RlKHRydWUpOw0KICAgICAgICAgICAgICAgIGRvbS5yZW1vdmUoKQ0KICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImhlYWQiKS5hcHBlbmRDaGlsZChuZXdEb20pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBhc3luYyBmdW5jdGlvbiBoYW5kbGVfbWVzc2FnZShldikgew0KICAgICAgICAgICAgICAgIGxldCB7IGFjdGlvbiwgY21kX2lkIH0gPSBldi5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHNlbmRfbWVzc2FnZSA9IChwYXlsb2FkKSA9PiBwYXJlbnQucG9zdE1lc3NhZ2UoIHsgLi4ucGF5bG9hZCB9LCBldi5vcmlnaW4pOw0KICAgICAgICAgICAgICAgIGNvbnN0IHNlbmRfcmVwbHkgPSAocGF5bG9hZCkgPT4gc2VuZF9tZXNzYWdlKHsgLi4ucGF5bG9hZCwgY21kX2lkIH0pOw0KICAgICAgICAgICAgICAgIGNvbnN0IHNlbmRfb2sgPSAoKSA9PiBzZW5kX3JlcGx5KHsgYWN0aW9uOiAnY21kX29rJyB9KTsNCiAgICAgICAgICAgICAgICBjb25zdCBzZW5kX2Vycm9yID0gKG1lc3NhZ2UsIHN0YWNrKSA9PiBzZW5kX3JlcGx5KHsgYWN0aW9uOiAnY21kX2Vycm9yJywgbWVzc2FnZSwgc3RhY2sgfSk7DQoNCiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnZXZhbCcpIHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY3JpcHRFbHMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0RWxzLmZvckVhY2goZWwgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5oZWFkLnJlbW92ZUNoaWxkKGVsKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0RWxzLmxlbmd0aCA9IDANCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHsgc2NyaXB0OiBzY3JpcHRzIH0gPSBldi5kYXRhLmFyZ3MNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2NyaXB0cyA9PT0gJ3N0cmluZycpIHNjcmlwdHMgPSBbc2NyaXB0c10NCg0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBzY3JpcHQgb2Ygc2NyaXB0cykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjcmlwdEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRFbC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnbW9kdWxlJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZW5kIG9rIGluIHRoZSBtb2R1bGUgc2NyaXB0IHRvIGVuc3VyZSBzZXF1ZW50aWFsIGV2YWx1YXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvZiBtdWx0aXBsZSBwcm94eS5ldmFsKCkgY2FsbHMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkb25lID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Ll9fbmV4dF9fID0gcmVzb2x2ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0RWwuaW5uZXJIVE1MID0gc2NyaXB0ICsgYFxud2luZG93Ll9fbmV4dF9fKClgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHRFbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRFbC5vbmVycm9yID0gZXJyID0+IHNlbmRfZXJyb3IoZXJyLm1lc3NhZ2UsIGVyci5zdGFjaykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHRFbHMucHVzaChzY3JpcHRFbCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBkb25lDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kX29rKCkNCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZF9lcnJvcihlLm1lc3NhZ2UsIGUuc3RhY2spOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2NhdGNoX2NsaWNrcycpIHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvcF9vcmlnaW4gPSBldi5vcmlnaW47DQogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCAhPT0gMSkgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5tZXRhS2V5IHx8IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQuc2hpZnRLZXkpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5zdXJlIHRhcmdldCBpcyBhIGxpbmsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZWwgPSBldmVudC50YXJnZXQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGVsICYmIGVsLm5vZGVOYW1lICE9PSAnQScpIGVsID0gZWwucGFyZW50Tm9kZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVsIHx8IGVsLm5vZGVOYW1lICE9PSAnQScpIHJldHVybjsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbC5oYXNBdHRyaWJ1dGUoJ2Rvd25sb2FkJykgfHwgZWwuZ2V0QXR0cmlidXRlKCdyZWwnKSA9PT0gJ2V4dGVybmFsJyB8fCBlbC50YXJnZXQpIHJldHVybjsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWwuaHJlZi5zdGFydHNXaXRoKHRvcF9vcmlnaW4pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoZWwuaHJlZik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1cmwuaGFzaFswXSA9PT0gJyMnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHVybC5oYXNoOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4oZWwuaHJlZiwgJ19ibGFuaycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kX29rKCk7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZF9lcnJvcihlLm1lc3NhZ2UsIGUuc3RhY2spOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gImxvYWRfZGVwZW5kZW5jaWVzIikgew0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbG9hZF9kZXBlbmRlbmNpZXMoZXYuZGF0YS5hcmdzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfb2soKQ0KICAgICAgICAgICAgICAgICAgICB9Y2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfZXJyb3IoZS5tZXNzYWdlLCBlLnN0YWNrKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGhhbmRsZV9tZXNzYWdlLCBmYWxzZSk7DQoNCiAgICAgICAgICAgIHdpbmRvdy5vbmVycm9yID0gZnVuY3Rpb24gKG1zZywgdXJsLCBsaW5lTm8sIGNvbHVtbk5vLCBlcnJvcikgew0KICAgICAgICAgICAgICAgIGlmIChtc2cuaW5jbHVkZXMoJ21vZHVsZSBzcGVjaWZpZXIg4oCcdnVl4oCdJykpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gZmlyZWZveCBvbmx5IGVycm9yLCBpZ25vcmUNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudC5wb3N0TWVzc2FnZSh7IGFjdGlvbjogJ2Vycm9yJywgdmFsdWU6IGVycm9yIH0sICcqJyk7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICdlcnJvcicsIHZhbHVlOiBtc2cgfSwgJyonKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ1bmhhbmRsZWRyZWplY3Rpb24iLCBldmVudCA9PiB7DQogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnJlYXNvbi5tZXNzYWdlLmluY2x1ZGVzKCdDcm9zcy1vcmlnaW4nKSkgew0KICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpDQogICAgICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICd1bmhhbmRsZWRyZWplY3Rpb24nLCB2YWx1ZTogZXZlbnQucmVhc29uIH0sICcqJyk7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICd1bmhhbmRsZWRyZWplY3Rpb24nLCB2YWx1ZTogZXZlbnQucmVhc29uLm1lc3NhZ2UgfSwgJyonKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgbGV0IHByZXZpb3VzID0geyBsZXZlbDogbnVsbCwgYXJnczogbnVsbCB9Ow0KDQogICAgICAgICAgICBbJ2NsZWFyJywgJ2xvZycsICdpbmZvJywgJ2RpcicsICd3YXJuJywgJ2Vycm9yJywgJ3RhYmxlJ10uZm9yRWFjaCgobGV2ZWwpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbCA9IGNvbnNvbGVbbGV2ZWxdOw0KICAgICAgICAgICAgICAgIGNvbnNvbGVbbGV2ZWxdID0gKC4uLmFyZ3MpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbXNnID0gU3RyaW5nKGFyZ3NbMF0pDQogICAgICAgICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICAgICAgICAgIG1zZy5pbmNsdWRlcygnWW91IGFyZSBydW5uaW5nIGEgZGV2ZWxvcG1lbnQgYnVpbGQgb2YgVnVlJykgfHwNCiAgICAgICAgICAgICAgICAgICAgICAgIG1zZy5pbmNsdWRlcygnWW91IGFyZSBydW5uaW5nIHRoZSBlc20tYnVuZGxlciBidWlsZCBvZiBWdWUnKQ0KICAgICAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmluZ2lmaWVkQXJncyA9IHN0cmluZ2lmeShhcmdzKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXMubGV2ZWwgPT09IGxldmVsICYmDQogICAgICAgICAgICAgICAgICAgICAgICBwcmV2aW91cy5hcmdzICYmDQogICAgICAgICAgICAgICAgICAgICAgICBwcmV2aW91cy5hcmdzID09PSBzdHJpbmdpZmllZEFyZ3MNCiAgICAgICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICdjb25zb2xlJywgbGV2ZWwsIGR1cGxpY2F0ZTogdHJ1ZSB9LCAnKicpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXMgPSB7IGxldmVsLCBhcmdzOiBzdHJpbmdpZmllZEFyZ3MgfTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICdjb25zb2xlJywgbGV2ZWwsIGFyZ3MgfSwgJyonKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5wb3N0TWVzc2FnZSh7IGFjdGlvbjogJ2NvbnNvbGUnLCBsZXZlbCwgYXJnczogYXJncy5tYXAoYSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIEVycm9yID8gYS5tZXNzYWdlIDogU3RyaW5nKGEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pIH0sICcqJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbCguLi5hcmdzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgWw0KICAgICAgICAgICAgICAgIHsgbWV0aG9kOiAnZ3JvdXAnLCBhY3Rpb246ICdjb25zb2xlX2dyb3VwJyB9LA0KICAgICAgICAgICAgICAgIHsgbWV0aG9kOiAnZ3JvdXBFbmQnLCBhY3Rpb246ICdjb25zb2xlX2dyb3VwX2VuZCcgfSwNCiAgICAgICAgICAgICAgICB7IG1ldGhvZDogJ2dyb3VwQ29sbGFwc2VkJywgYWN0aW9uOiAnY29uc29sZV9ncm91cF9jb2xsYXBzZWQnIH0sDQogICAgICAgICAgICBdLmZvckVhY2goKGdyb3VwX2FjdGlvbikgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsID0gY29uc29sZVtncm91cF9hY3Rpb24ubWV0aG9kXTsNCiAgICAgICAgICAgICAgICBjb25zb2xlW2dyb3VwX2FjdGlvbi5tZXRob2RdID0gKGxhYmVsKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHBhcmVudC5wb3N0TWVzc2FnZSh7IGFjdGlvbjogZ3JvdXBfYWN0aW9uLmFjdGlvbiwgbGFiZWwgfSwgJyonKTsNCg0KICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbChsYWJlbCk7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBjb25zdCB0aW1lcnMgPSBuZXcgTWFwKCk7DQogICAgICAgICAgICBjb25zdCBvcmlnaW5hbF90aW1lID0gY29uc29sZS50aW1lOw0KICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxfdGltZWxvZyA9IGNvbnNvbGUudGltZUxvZzsNCiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsX3RpbWVlbmQgPSBjb25zb2xlLnRpbWVFbmQ7DQoNCiAgICAgICAgICAgIGNvbnNvbGUudGltZSA9IChsYWJlbCA9ICdkZWZhdWx0JykgPT4gew0KICAgICAgICAgICAgICAgIG9yaWdpbmFsX3RpbWUobGFiZWwpOw0KICAgICAgICAgICAgICAgIHRpbWVycy5zZXQobGFiZWwsIHBlcmZvcm1hbmNlLm5vdygpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnNvbGUudGltZUxvZyA9IChsYWJlbCA9ICdkZWZhdWx0JykgPT4gew0KICAgICAgICAgICAgICAgIG9yaWdpbmFsX3RpbWVsb2cobGFiZWwpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlLm5vdygpOw0KICAgICAgICAgICAgICAgIGlmICh0aW1lcnMuaGFzKGxhYmVsKSkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICdjb25zb2xlJywgbGV2ZWw6ICdzeXN0ZW0tbG9nJywgYXJnczogW2Ake2xhYmVsfTogJHtub3cgLSB0aW1lcnMuZ2V0KGxhYmVsKX1tc2BdIH0sICcqJyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnBvc3RNZXNzYWdlKHsgYWN0aW9uOiAnY29uc29sZScsIGxldmVsOiAnc3lzdGVtLXdhcm4nLCBhcmdzOiBbYFRpbWVyICcke2xhYmVsfScgZG9lcyBub3QgZXhpc3RgXSB9LCAnKicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnNvbGUudGltZUVuZCA9IChsYWJlbCA9ICdkZWZhdWx0JykgPT4gew0KICAgICAgICAgICAgICAgIG9yaWdpbmFsX3RpbWVlbmQobGFiZWwpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlLm5vdygpOw0KICAgICAgICAgICAgICAgIGlmICh0aW1lcnMuaGFzKGxhYmVsKSkgew0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICdjb25zb2xlJywgbGV2ZWw6ICdzeXN0ZW0tbG9nJywgYXJnczogW2Ake2xhYmVsfTogJHtub3cgLSB0aW1lcnMuZ2V0KGxhYmVsKX1tc2BdIH0sICcqJyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnBvc3RNZXNzYWdlKHsgYWN0aW9uOiAnY29uc29sZScsIGxldmVsOiAnc3lzdGVtLXdhcm4nLCBhcmdzOiBbYFRpbWVyICcke2xhYmVsfScgZG9lcyBub3QgZXhpc3RgXSB9LCAnKicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aW1lcnMuZGVsZXRlKGxhYmVsKTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsX2Fzc2VydCA9IGNvbnNvbGUuYXNzZXJ0Ow0KICAgICAgICAgICAgY29uc29sZS5hc3NlcnQgPSAoY29uZGl0aW9uLCAuLi5hcmdzKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKGNvbmRpdGlvbikgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFjayA9IG5ldyBFcnJvcigpLnN0YWNrOw0KICAgICAgICAgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICdjb25zb2xlJywgbGV2ZWw6ICdhc3NlcnQnLCBhcmdzLCBzdGFjayB9LCAnKicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBvcmlnaW5hbF9hc3NlcnQoY29uZGl0aW9uLCAuLi5hcmdzKTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGNvbnN0IGNvdW50ZXIgPSBuZXcgTWFwKCk7DQogICAgICAgICAgICBjb25zdCBvcmlnaW5hbF9jb3VudCA9IGNvbnNvbGUuY291bnQ7DQogICAgICAgICAgICBjb25zdCBvcmlnaW5hbF9jb3VudHJlc2V0ID0gY29uc29sZS5jb3VudFJlc2V0Ow0KDQogICAgICAgICAgICBjb25zb2xlLmNvdW50ID0gKGxhYmVsID0gJ2RlZmF1bHQnKSA9PiB7DQogICAgICAgICAgICAgICAgY291bnRlci5zZXQobGFiZWwsIChjb3VudGVyLmdldChsYWJlbCkgfHwgMCkgKyAxKTsNCiAgICAgICAgICAgICAgICBwYXJlbnQucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICdjb25zb2xlJywgbGV2ZWw6ICdzeXN0ZW0tbG9nJywgYXJnczogYCR7bGFiZWx9OiAke2NvdW50ZXIuZ2V0KGxhYmVsKX1gIH0sICcqJyk7DQogICAgICAgICAgICAgICAgb3JpZ2luYWxfY291bnQobGFiZWwpOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgY29uc29sZS5jb3VudFJlc2V0ID0gKGxhYmVsID0gJ2RlZmF1bHQnKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKGNvdW50ZXIuaGFzKGxhYmVsKSkgew0KICAgICAgICAgICAgICAgICAgICBjb3VudGVyLnNldChsYWJlbCwgMCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnBvc3RNZXNzYWdlKHsgYWN0aW9uOiAnY29uc29sZScsIGxldmVsOiAnc3lzdGVtLXdhcm4nLCBhcmdzOiBgQ291bnQgZm9yICcke2xhYmVsfScgZG9lcyBub3QgZXhpc3RgIH0sICcqJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG9yaWdpbmFsX2NvdW50cmVzZXQobGFiZWwpOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxfdHJhY2UgPSBjb25zb2xlLnRyYWNlOw0KDQogICAgICAgICAgICBjb25zb2xlLnRyYWNlID0gKC4uLmFyZ3MpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBzdGFjayA9IG5ldyBFcnJvcigpLnN0YWNrOw0KICAgICAgICAgICAgICAgIHBhcmVudC5wb3N0TWVzc2FnZSh7IGFjdGlvbjogJ2NvbnNvbGUnLCBsZXZlbDogJ3RyYWNlJywgYXJncywgc3RhY2sgfSwgJyonKTsNCiAgICAgICAgICAgICAgICBvcmlnaW5hbF90cmFjZSguLi5hcmdzKTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIHN0cmluZ2lmeShhcmdzKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGFyZ3MpOw0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSkoKQ0KICAgIDwvc2NyaXB0Pg0KPC9oZWFkPg0KPGJvZHk+DQogICAgPGRpdiBpZD0iYXBwIj48L2Rpdj4NCjwvYm9keT4NCjwvaHRtbD4NCg=="}),n("design:type",String)],A.prototype,"initialSrcDoc",void 0),e([I.Prop({type:Boolean,default:!1}),n("design:type",Boolean)],A.prototype,"isBeforeRefresh",void 0),e([I.Emit("message"),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",void 0)],A.prototype,"emitEvent",null),A=e([I.Component({name:"wu-code-sandbox",css:t}),n("design:paramtypes",[])],A)}(I.WuComponent);g.WuMonacoEditorPreview=r,Object.defineProperty(g,"__esModule",{value:!0})}));
